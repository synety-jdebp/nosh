# shell pre-deinstall function library for Debian
escape() { system-control escape --alt-escape -- "$@" ; }
del_user() { 
	if getent passwd "$1" > /dev/null 
	then
		printf 1>&2 "Removing user: %s\n" "$1"
		userdel "$1" 
	fi
}
shut_down() {
	for i
	do
		system-control disable "$i"
		if system-control is-loaded "$i"
		then
			system-control unload-when-stopped "$i"
			if system-control is-active "$i"
			then
				printf 1>&2 "Stop: %s\n" "$i"
				system-control stop "$i"
			fi
		fi
	done
}
service_with_dedicated_logger() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1.service" "cyclog@$1.service"
	fi
}
login_service_with_dedicated_logger() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "ttylogin@$1.service" "cyclog@ttylogin@$1.service"
	fi
}
ktty_login_service_with_dedicated_logger() {
	case "`uname`" in
	OpenBSD)	ktty=ttyC; break ;;
	Linux)		ktty=tty; break ;;
	*)		ktty=ttyv; break ;;
	esac
	login_service_with_dedicated_logger "${ktty}$1"
}
socket_with_dedicated_logger() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1.socket" "cyclog@$1.service"
	fi
}
service_only() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1.service"
	fi
}
service_only_no_run() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1.service"
	fi
}
socket_only() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1.socket"
	fi
}
fan_in_logger() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1-log.service"
	fi
}
target() {
	if test -z "${nosh_run_package}"
	then
		:
	else
		shut_down "$1.target"
	fi
}
# Don't delete the log service users because the log files still exist.
log_user() {
	:
}
non_log_user() {
	local pwescaped="`escape "$1"`"
	del_user "$pwescaped"
}
non_log_group() {
	:
}
user_tty() {
	:
}
